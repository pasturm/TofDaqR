#! /bin/bash

# copy the relevant dynamic libraries to ${R_PACKAGE_DIR}/libs
mkdir -p "${R_PACKAGE_DIR}/libs"
if [[ "$OSTYPE" == "darwin"* && "$HOSTTYPE" == "x86_64" ]]; then
cp ./tools/TofDaq/bin/macos_x86_64/* "${R_PACKAGE_DIR}/libs"
elif [[ "$OSTYPE" = "darwin"* && "$HOSTTYPE" == "i386" ]]; then
cp ./tools/TofDaq/bin/macos_i386/* "${R_PACKAGE_DIR}/libs"
elif [[ "$OSTYPE" = "linux-gnu" && "$HOSTTYPE" == "x86_64" ]]; then
cp ./tools/TofDaq/bin/linux_x86_64/* "${R_PACKAGE_DIR}/libs"
else
echo "OS not supported."
fi

# remove TofDaqDll.R and AdditionalTofDaqDll.R
if [ -e ./R/TofDaqDll.R ]; then
mv ./R/TofDaqDll.R ./tools/TofDaqDll.R
fi
if [ -e ./R/AdditionalTofDaqDll.R ]; then
mv ./R/AdditionalTofDaqDll.R ./tools/AdditionalTofDaqDll.R
fi

# replace NAMESPACE with NAMESPACE.linux
mv NAMESPACE ./tools/NAMESPACE.windows
cp ./tools/NAMESPACE.linux NAMESPACE

# replace ./man with ./man.linux
mkdir -p ./tools/man.windows
mv ./man/* ./tools/man.windows
cp ./tools/man.linux/* ./man

# replace zzz.R with zzz.R.linux
mv ./R/zzz.R ./tools/zzz.R.windows
cp ./tools/zzz.R.linux ./R/zzz.R
