#! /bin/bash

if [ -e ./tools/TofDaqDll.R ]; then

# restore TofDaqDll.R, original NAMESPACE and zzz.R
mv ./tools/TofDaqDll.R ./R/TofDaqDll.R
mv ./tools/AdditionalTofDaqDll.R ./R/AdditionalTofDaqDll.R
mv NAMESPACE.windows NAMESPACE
rm NAMESPACE.tmp
mv ./R/zzz.R.windows ./R/zzz.R

# move TofDaqDll help files back to ./man
mv ./tools/AddAttributeDouble.Rd ./man
mv ./tools/AddAttributeInt.Rd ./man
mv ./tools/AddAttributeString.Rd ./man
mv ./tools/AddLogEntry.Rd ./man
mv ./tools/AddUserData.Rd ./man
mv ./tools/AddUserDataMultiRow.Rd ./man
mv ./tools/AutoSetupDaqDevice.Rd ./man
mv ./tools/CleanupDll.Rd ./man
mv ./tools/CloseTofDaqRec.Rd ./man
mv ./tools/DaqActive.Rd ./man
mv ./tools/FindTpsIp.Rd ./man
mv ./tools/GetBufTimeFromShMem.Rd ./man
mv ./tools/GetDaqParameter.Rd ./man
mv ./tools/GetDescriptor.Rd ./man
mv ./tools/GetDllVersion.Rd ./man
mv ./tools/GetPeakParameters.Rd ./man
mv ./tools/GetRegUserDataDesc.Rd ./man
mv ./tools/GetRegUserDataSources.Rd ./man
mv ./tools/GetSegmentProfileFromShMem.Rd ./man
mv ./tools/GetSpecXaxisFromShMem.Rd ./man
mv ./tools/GetStickSpectrumFromShMem.Rd ./man
mv ./tools/GetSumSpectrumFromShMem.Rd ./man
mv ./tools/GetTimeout.Rd ./man
mv ./tools/GetTofSpectrumFromShMem.Rd ./man
mv ./tools/InitializeDaqDevice.Rd ./man
mv ./tools/InitializeDll.Rd ./man
mv ./tools/KeepFileOpen.Rd ./man
mv ./tools/KeepSharedMemMapped.Rd ./man
mv ./tools/LoadIniFile.Rd ./man
mv ./tools/OnDemandMassCalibration.Rd ./man
mv ./tools/QueryRegUserDataSize.Rd ./man
mv ./tools/ReadRegUserData.Rd ./man
mv ./tools/RegisterUserDataBuf.Rd ./man
mv ./tools/RegisterUserDataNoStore.Rd ./man
mv ./tools/RegisterUserDataWrite.Rd ./man
mv ./tools/ReleaseSharedMemory.Rd ./man
mv ./tools/SaveIniFile.Rd ./man
mv ./tools/SetDaqParameter.Rd ./man
mv ./tools/SetTimeout.Rd ./man
mv ./tools/ShowConfigWindow.Rd ./man
mv ./tools/SiProcessSpectrumFromShMem.Rd ./man
mv ./tools/StartAcquisition.Rd ./man
mv ./tools/StopAcquisition.Rd ./man
mv ./tools/TofDaqRunning.Rd ./man
mv ./tools/TpsChangeIonMode.Rd ./man
mv ./tools/TpsConnect.Rd ./man
mv ./tools/TpsConnect2.Rd ./man
mv ./tools/TpsDisconnect.Rd ./man
mv ./tools/TpsGetActiveFilament.Rd ./man
mv ./tools/TpsGetLastSetValue.Rd ./man
mv ./tools/TpsGetModuleCodes.Rd ./man
mv ./tools/TpsGetModuleLimits.Rd ./man
mv ./tools/TpsGetMonitorValue.Rd ./man
mv ./tools/TpsGetNbrModules.Rd ./man
mv ./tools/TpsGetStatus.Rd ./man
mv ./tools/TpsGetTargetValue.Rd ./man
mv ./tools/TpsInitialize.Rd ./man
mv ./tools/TpsLoadSetFile.Rd ./man
mv ./tools/TpsSaveSetFile.Rd ./man
mv ./tools/TpsSetActiveFilament.Rd ./man
mv ./tools/TpsSetAllVoltages.Rd ./man
mv ./tools/TpsSetTargetValue.Rd ./man
mv ./tools/TpsShutdown.Rd ./man
mv ./tools/UnregisterUserData.Rd ./man
mv ./tools/UpdateUserData.Rd ./man
mv ./tools/WaitForEndOfAcquisition.Rd ./man
mv ./tools/WaitForNewData.Rd ./man
fi

# fix the paths in the dylibs for macOS
if [[ "$OSTYPE" == "darwin"* && -e "${R_PACKAGE_DIR}/libs" ]]; then
cd "${R_PACKAGE_DIR}/libs"
install_name_tool -change libtwh5.dylib @loader_path/libtwh5.dylib TofDaqR.so
install_name_tool -change libtwtool.dylib @loader_path/libtwtool.dylib TofDaqR.so
install_name_tool -change libtwtool.dylib @loader_path/libtwtool.dylib libtwh5.dylib
fi
